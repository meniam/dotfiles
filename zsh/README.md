# Конфигурация ZSH

Это модульная конфигурация Zsh shell с использованием Oh My Zsh в качестве базового фреймворка. Конфигурация организована по принципу разделения на специализированные модули для лучшей поддержки и расширяемости.

## Структура файлов

```
zsh/
├── .zshrc              # Основной конфигурационный файл
├── .aliases            # Алиасы и сокращения команд
└── .config/
    └── zsh/
        ├── modules/    # Модули конфигурации
        ├── plugins/    # Пользовательские плагины
        └── themes/     # Пользовательские темы
```

## Основные компоненты

### 1. Основной конфигурационный файл (.zshrc)

Главный файл загружает Oh My Zsh и подключает все модули:

- **Тема**: `meniam` (кастомная тема)
- **Плагины Oh My Zsh**:
  - `macos` - интеграция с macOS
  - `symfony2` - поддержка Symfony
  - `colorize` - цветной вывод
  - `github` - интеграция с GitHub
  - `brew` - автодополнение для Homebrew
  - `git` - расширенная поддержка Git
  - `docker` / `docker-compose` - поддержка Docker
  - `zjump` - быстрая навигация по директориям
  - `zsh-autosuggestions` - автоподсказки команд
  - `zsh-syntax-highlighting` - подсветка синтаксиса
  - `zsh-history-substring-search` - поиск по истории
  - `z` - умная навигация по директориям

### 2. Модули конфигурации (.config/zsh/modules/)

#### general.zsh

**Назначение**: Основные настройки shell и утилитные функции

**Ключевые возможности**:

- Настройка локали (en_US.UTF-8)
- Цветовая схема для файловой системы (LS_COLORS/LSCOLORS)
- Настройка редакторов по умолчанию (mcedit)
- Конфигурация FZF (fuzzy finder)

**Утилитные функции**:

- `yy()` - интеграция с файловым менеджером yazi
- `htt()` - форматирование HTTP ответов
- `pid()` - поиск процессов
- `alias-list()` - цветной список алиасов
- `hash-list()` - список команд с путями
- `tkdir()` - создание и переход в директорию
- `annotate()` - вывод комментариев с форматированием
- `workspace()` - выполнение команды во всех поддиректориях
- `random()` - генерация случайных символов
- `weather()` - прогноз погоды для Воронежа
- `man()` - цветной man с подсветкой
- `diff()` - цветной diff

**Привязки клавиш**:

- `Ctrl+X, Ctrl+E` - редактирование команды в $EDITOR
- Специальные привязки для IntelliJ Terminal

#### path.zsh

**Назначение**: Управление переменной PATH

**Логика работы**:

1. Получение системного PATH через getconf
2. Определение префикса Homebrew (/opt/homebrew или /usr/local)
3. Добавление директорий в приоритетном порядке
4. Удаление дубликатов с сохранением порядка

**Включаемые пути**:

- Системные: `/bin`, `/usr/bin`, `/usr/local/bin`
- Homebrew: `$HOMEBREW_PREFIX/bin`, включая GNU utilities
- Пользовательские: `$DOT_BIN`, `$HOME/bin`
- Системные sbin директории

#### history.zsh

**Назначение**: Расширенная настройка истории команд

**Параметры**:

- Размер истории: 100,000 команд
- Файл истории: `~/.zhistory`
- Формат временных меток: расширенный

**Функции**:

- `EXTENDED_HISTORY` - сохранение времени выполнения
- `APPEND_HISTORY` - добавление в конец файла
- `INC_APPEND_HISTORY` - немедленная запись
- `SHARE_HISTORY` - общая история между сессиями
- `HIST_IGNORE_ALL_DUPS` - игнорирование всех дубликатов
- `HIST_IGNORE_SPACE` - игнорирование команд, начинающихся с пробела
- `HIST_VERIFY` - подтверждение команд из истории

**Утилиты**:

- `history-edit()` - редактирование файла истории

#### completion.zsh

**Назначение**: Продвинутая система автодополнения

**Основные настройки**:

- Кэширование дополнений (проверка каждые 24 часа)
- Регистронезависимое дополнение
- Группировка по типам
- Цветовое выделение

**Возможности**:

- Интерактивное меню выбора
- Описания для опций команд
- Специальная обработка процессов
- Приоритет локальных директорий для cd
- Кастомный виджет с индикатором загрузки

**Стилизация**:

- Цветные описания групп (magenta)
- Предупреждения о отсутствии совпадений (red)
- Цветовая схема файлов из LS_COLORS

#### plugins.zsh

**Назначение**: Настройка дополнительных плагинов

**zsh-syntax-highlighting**:

- Подсветка основного синтаксиса и скобок
- Ограничение длины анализа: 300 символов

**zsh-autosuggestions**:

- Стиль: серый текст с подчеркиванием
- Цвет: `#6d7072` на черном фоне

**zsh-history-substring-search**:

- Подсветка найденного: magenta bold
- Подсветка не найденного: black bold
- Включен fuzzy поиск
- Привязка к стрелкам вверх/вниз

#### hello.zsh

**Назначение**: Приветственное сообщение

Выводит мотивационное сообщение на русском языке и информацию о дисковом пространстве (через pydf) при запуске оболочки вне tmux.

#### fzf-bindings.zsh и fzf-completion.zsh

**Назначение**: Интеграция с FZF (fuzzy finder)

**Возможности**:

- `Ctrl+T` - выбор файлов/директорий
- `Ctrl+R` - поиск по истории
- `Alt+C` - быстрая смена директории
- Автодополнение для команд с `**`

### 3. Темы (.config/zsh/themes/)

#### meniam.zsh-theme

**Назначение**: Кастомная тема для промпта

**Функции**:

- Цветовое различие для root (красный) и обычного пользователя (зеленый)
- Отображение: пользователь@хост путь
- Интеграция с Git (показ ветки и статуса)
- Символы: ✗ для измененных файлов

### 4. Алиасы (.aliases)

Организованы по категориям:

#### Управление dotfiles

- `dfupdate`, `dfupgrade` - обновление конфигурации
- `reload`, `update` - перезагрузка и обновление

#### TMUX

- `mux` - tmuxinator
- `t`, `ta`, `tn`, `tc`, `tl` - управление сессиями

#### Навигация

- `..`, `...`, `....`, `.....` - быстрый подъем по директориям
- `www`, `dl`, `dt` - быстрые переходы
- `cd` - тихий cd без вывода

#### Файловые операации

- `ls`, `ll`, `lla` - улучшенные листинги
- `ll1`, `ll2` - древовидный вывод с eza
- `mv`, `cp`, `rm` - с подтверждением

#### Системные утилиты

- `du`, `df` - с человекочитаемыми размерами
- `grep`, `less` - с цветами
- `hosts` - редактирование /etc/hosts

#### Разработка

- `dc` - docker-compose
- `g` - git
- `pgt`, `pga` - PostgreSQL мониторинг
- `p` - fzf для выбора файлов
- `e` - редактирование выбранного файла

#### Сеть и безопасность

- `myip`, `myipl` - определение IP
- `speedtest` - тест скорости
- `pass` - генерация паролей

#### macOS специфичные

- `chrome` - запуск Chrome
- `cleanup` - удаление .DS_Store файлов
- `afk` - блокировка экрана

## Переменные окружения

### Основные пути

- `DOT_BIN` - `$HOME/.bin`
- `CONFIG_ZSH` - `$HOME/.config/zsh`
- `ZSH_CUSTOM` - `$HOME/.config/zsh`

### Редакторы

- `VISUAL`, `EDITOR` - `mcedit`
- `PAGER` - `less`

### FZF настройки

- Цветовая схема настроена для темной темы
- Интеграция с `fd` для быстрого поиска
- Предпросмотр файлов через `bat`

## Интеграции

### Homebrew

- Автоматическое определение пути установки (Intel/Apple Silicon)
- Приоритет GNU утилит над системными
- Интеграция с PostgreSQL, PHP

### Git

- Расширенные алиасы и автодополнение
- Отображение статуса в промпте
- Поддержка GitHub команд

### Docker

- Автодополнение для docker и docker-compose
- Алиас для быстрого доступа
- Интеграция с lazydocker

### Файловые менеджеры

- Интеграция с yazi (современный файловый менеджер)
- Поддержка eza для улучшенного листинга

## Производительность

### Оптимизации

- Кэширование автодополнений (проверка раз в 24 часа)
- Ленивая загрузка некоторых компонентов
- Ограничение анализа подсветки синтаксиса

### Условная загрузка

- Приветственное сообщение только вне tmux
- Опциональная загрузка локальных настроек из `~/.zshrc.local`
- Условная загрузка acme.sh окружения

## Расширяемость

### Локальная конфигурация

Файл `~/.zshrc.local` автоматически загружается для пользовательских настроек без изменения основной конфигурации.

### Модульная архитектура

Каждый аспект конфигурации выделен в отдельный модуль, что позволяет:

- Легко отключать ненужную функциональность
- Добавлять новые модули
- Поддерживать чистоту кода

### Кастомизация

- Цветовые схемы настраиваются в одном месте
- Алиасы сгруппированы по назначению
- Функции документированы и легко модифицируются

## Зависимости

### Обязательные

- `zsh` - оболочка
- `oh-my-zsh` - фреймворк

### Рекомендуемые

- `fzf` - fuzzy finder
- `fd` - быстрый поиск файлов
- `bat` - улучшенный cat с подсветкой
- `eza` - современная замена ls
- `yazi` - файловый менеджер
- `pydf` - информация о дисках
- `tmux` / `tmuxinator` - мультиплексор терминала
- `lazydocker` - Docker TUI

Эта конфигурация представляет собой полнофункциональную среду разработки с акцентом на производительность, удобство использования и расширяемость.
